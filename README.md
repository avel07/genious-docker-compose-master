# Bitrix + Nuxt 3 | Docker traefik+nginx
Docker compose обертка сервера для bitrix + nuxt 3 с автоматическим получением сертификатов (traefik) и хранением всех конфигураций, логов, данных в одной директории.

## Файловая структура
```
docker/                          Директория docker compose
docker/config                    Директория файлов конфигурации         
docker/config/nginx/sites        Настройки конфига nginx под каждый сервис   
docker/logs/                     Директория логов от всех подключенных сервисов
docker/private/                  Хранилище для mysql ssl и т.д
docker/scripts/                  Скрипты для развертывания, деплоя и т.п. (Подробнее в Make разделе)

web/                             Директория приложений
web/bitrix/                      Директория bitrix
web/nuxt/                        Директория nuxt (только для локальной разработки. В проде директория не монтируется)

.env                             Базовые настройки для запуска (Обязательно настройте!)
.gitlab-ci.yml                   Gitlab-CI для сборки, и деплоя через gitlab
Makefile                         Команды для Make утилиты
```

## Запуск отдельно frontend среды разработки (Только Nuxt)
1. Клонируем данный репозиторий
2. Переходим в папку nuxt `cd web/nuxt`
3. Устанавливаем пакеты `npm i`
4. Запускаем как стандартный Nuxt 3 `npm run dev`

*Дефолтный API сервер определяетсяв файле `web/nuxt/nuxt.config.ts` (apiBase)*

## Установка локальной среды (Bitrix + Nuxt)
Для полноценной, приблеженной к прод. среде, разработке потребуется:
 - Linux (или wsl или виртуалка)
 - Git 
 - Docker 
 - Docker compose plugin

Все это отлично ставится на wsl2 (если разрабатывается из по windows)  

Для установки локальной среды скачиваем данный репозиторий:
```
cd {WORK_DIR}
git clone git@gitlab.Cube.net:lighthouse/genious-project/genious-docker-compose.git .
```

Создаем файл .env по примеру .env.example;  

Запускаем среду разработки:
Включить среду разработки - `make start`
Отключить среду разработки - `make stop`

## Traefik и nginx
Т.к traefik выступает в роли обратного прокси-сервера к nginx, то конфиги nginx могут отдавать только 80 порт, без ssl, 443 и т.д.  
SSL и сертификаты, а также http 2 и прочее регулируем через traefik

## Make утилита
Для упрощения работы с сервером многие команды прописаны при помощи утилиты Make
Для использования в консоли используем `make *команда*`

```
fix                            Исправляет права на файлы (нужен sudo)
help                           Отобразить все команды
prod                           Поднять продакшн
shell-nuxt                     Открыть консоль в контейнере nuxt
shell                          Открыть консоль в контейнере php (bitrix)
start                          Поднять docker compose для локальной разработки (bitrix - localhost:80, nuxt - localhost:3000)
stop                           Отключаем все сервисы
```